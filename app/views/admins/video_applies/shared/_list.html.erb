<% is_processed = params[:status].to_s != 'pending' %>

<table class="table table-hover text-center library_applies-list-table">
  <thead class="thead-light">
  <tr>
    <th width="4%">序号</th>
    <th width="8%">头像</th>
    <th width="14%">姓名</th>
    <th width="26%" class="text-left">视频名称</th>
    <th width="13%">视频大小</th>
    <th width="13%" class="text-left">播放链接</th>
    <th width="12%">时间</th>
    <% if is_processed %>
      <th width="16%">拒绝原因</th>
      <th width="8%">状态</th>
    <% else %>
      <th width="20%">操作</th>
    <% end %>
  </tr>
  </thead>
  <tbody>
  <% if applies.present? %>
    <% applies.each_with_index do |v, index| %>
      <% video = v.video %>
      <% user = video.user %>
      <tr class="video-applies-item video-applies-<%= v.id %>">
        <td><%= list_index_no((params[:page] || 1).to_i, index) %></td>
        <td>
          <%= link_to "/users/#{user.login}", class: 'professional-authentication-avatar', target: '_blank', data: { toggle: 'tooltip', title: '个人主页' } do %>
            <img src="/images/<%= url_to_avatar(user) %>" class="rounded-circle" width="40" height="40" />
          <% end %>
        </td>
        <td><%= link_to user&.real_name,"/users/#{user&.login}", target: "_blank" %></td>
        <td class="text-left"><%= link_to video.title, video.file_url, :target => "_blank"  %></td>
        <td><%= video.filesize&.to_s(:human_size) %></td>
        <td class="text-left"><%= link_to "播放视频",video.file_url, target: "_blank" %></td>
        <td><%= v.updated_at.strftime('%Y-%m-%d %H:%M') %></td>
        <% if is_processed %>
          <td class="text-secondary"><%= overflow_hidden_span v.reason %></td>
          <td><span class="apply-status-<%= v.status %>"><%= t("admins_apply_status.status.#{v.status}") %></span></td>
        <% else %>
          <td class="action-container">
            <%= agree_link '同意', agree_admins_video_apply_path(v, element: ".video_applies-#{v.id}"), 'data-confirm': '确认审核通过？' %>
            <%= javascript_void_link('拒绝', class: 'action refuse-action',
                                     data: {
                                         toggle: 'modal', target: '.admin-common-refuse-modal', id: v.id,
                                         url: refuse_admins_video_apply_path(v, element: ".video_applies-#{v.id}")
                                     }) %>
          </td>
        <% end %>
      </tr>
    <% end %>
  <% else %>
    <%= render 'admins/shared/no_data_for_table' %>
  <% end %>
  </tbody>
</table>

<%= render partial: 'admins/shared/paginate', locals: { objects: applies } %>